# ElementHider

ページ上の任意の要素をクリック操作で非表示にできる Chrome 拡張機能です。
非表示にした要素はホスト名ごとに保存され、次回以降のアクセス時にも自動的に適用されます。

---

## 機能

- **ビジュアルピッカー** — カーソルで要素をハイライトしながら選択
- **トグル表示/非表示** — 管理リスト上でアイコンをクリックするだけで切り替え
- **永続化** — `chrome.storage.local` にホスト名単位で保存。ページをリロードしても維持される
- **管理リスト** — 追加した要素はリストに残り続ける。削除するまで管理対象

---

## 使い方

### 要素を非表示にする

1. 拡張アイコンをクリックしてポップアップを開く
2. **「要素を選択して非表示」** ボタンをクリック
   → ポップアップが自動で閉じ、カーソルが十字に変わる
3. 非表示にしたい要素にマウスを合わせてクリック
   → 要素が非表示になり、ポップアップが自動で再表示される

> **注意：** ポップアップを閉じることでページ上の要素を選択できるようにしています。
> 選択完了後、ポップアップは自動で開き直されます。
> `Esc` キーでピッカーをキャンセルできます。

### 表示/非表示をトグルする

管理リスト上の **目アイコン** をクリックすると、要素の表示と非表示を切り替えられます。
要素はリストから削除されず、管理対象のまま維持されます。

| アイコン | 意味 |
|---|---|
| 目（斜線なし・緑）| 現在**表示中** — クリックで非表示に |
| 目（斜線あり・灰）| 現在**非表示** — クリックで表示に |

### 管理リストから削除する

**ゴミ箱アイコン** をクリックすると管理リストから完全に削除されます。
非表示中の要素を削除した場合は、削除前に自動で表示に戻されます。

---

## 技術スタック

| 用途 | ライブラリ |
|---|---|
| UI フレームワーク | React 18 |
| スタイリング | Tailwind CSS + DaisyUI |
| ビルドツール | Vite + vite-plugin-web-extension |
| 言語 | TypeScript |

---

## アーキテクチャ

```
src/
├── popup/
│   ├── App.tsx      # ポップアップ UI（管理リスト・トグル・削除）
│   ├── icons.tsx    # SVG アイコンコンポーネント
│   ├── main.tsx     # React マウント
│   └── index.css    # Tailwind エントリ
├── content/
│   └── content.tsx  # コンテンツスクリプト（ピッカー・DOM操作・ストレージ）
└── background/
    └── background.ts # サービスワーカー（要素選択後にポップアップを再表示）
```

### メッセージフロー

```
popup → content  : START_PICKER / STOP_PICKER / SHOW_ELEMENT / HIDE_ELEMENT
content → runtime: ELEMENT_HIDDEN（要素選択完了の通知）
background       : ELEMENT_HIDDEN を受信 → chrome.action.openPopup() で再表示
```

### ストレージ構造

`chrome.storage.local` にホスト名をキーとして保存されます。

```json
{
  "example.com": [
    {
      "selector": "body > div.ads",
      "preview": "広告テキスト",
      "timestamp": 1708300000000,
      "isHidden": true
    }
  ]
}
```

---

## 開発

```bash
# 依存関係のインストール
npm install

# ウォッチモードでビルド（開発用）
npm run dev

# 本番ビルド
npm run build
```

ビルド後、`dist/` フォルダを Chrome の **拡張機能の管理** ページ（`chrome://extensions`）で
「パッケージ化されていない拡張機能を読み込む」から読み込んでください。

---

## 動作要件

- Chrome 127 以降
  （`chrome.action.openPopup()` API の利用のため）
